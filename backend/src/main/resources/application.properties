# ═══════════════════════════════════════════════════════════════════════════════
# DBaaS Platform - Main Configuration (Development)
# ═══════════════════════════════════════════════════════════════════════════════

spring.application.name=dbaas-platform

# ═══════════════════════════════════════════════════════════════════════════════
# Database - PostgreSQL (Development)
# ═══════════════════════════════════════════════════════════════════════════════
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/dbaas}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD}

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=true

# Flyway enabled for PostgreSQL
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true

# ═══════════════════════════════════════════════════════════════════════════════
# Redis Cache Configuration
# ═══════════════════════════════════════════════════════════════════════════════
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=5000ms
spring.cache.type=redis

# ═══════════════════════════════════════════════════════════════════════════════
# Server Configuration
# ═══════════════════════════════════════════════════════════════════════════════
server.port=8080

# ═══════════════════════════════════════════════════════════════════════════════
# Security Configuration (EXTERNALIZED - Use environment variables in production!)
# ═══════════════════════════════════════════════════════════════════════════════
# JWT Authentication (REQUIRED - No defaults for security)
security.jwt.secret=${JWT_SECRET}
security.jwt.expiration-ms=${JWT_EXPIRATION:86400000}
security.jwt.refresh-expiration-ms=${JWT_REFRESH_EXPIRATION:604800000}
security.jwt.issuer=dbaas-platform

# Encryption (for sensitive data storage)
security.encryption.key=${ENCRYPTION_KEY}
security.encryption.algorithm=AES/GCM/NoPadding

# Cluster Secrets (REQUIRED - Must be set via environment variables)
security.cluster.mysql-root-password=${MYSQL_ROOT_PASSWORD}
security.cluster.replication-password=${MYSQL_REPL_PASSWORD}
security.cluster.orchestrator-password=${ORCH_PASSWORD}
security.cluster.proxysql-admin-password=${PROXYSQL_ADMIN_PASSWORD}

# Legacy JWT config (for backward compatibility)
jwt.secret=${security.jwt.secret}
jwt.expiration=${security.jwt.expiration-ms}

# ═══════════════════════════════════════════════════════════════════════════════
# Docker Configuration (Linux - Unix socket)
# ═══════════════════════════════════════════════════════════════════════════════
docker.host=unix:///var/run/docker.sock
docker.tls-verify=false

# ═══════════════════════════════════════════════════════════════════════════════
# Cluster Defaults
# ═══════════════════════════════════════════════════════════════════════════════
cluster.defaults.mysql-version=8.0
cluster.defaults.replica-count=2
cluster.defaults.cpu-limit=2
cluster.defaults.memory-limit=4G
cluster.defaults.storage-limit=50G
cluster.network.subnet-prefix=172.28
cluster.ports.base=33060
cluster.ports.step=10

# ═══════════════════════════════════════════════════════════════════════════════
# ProxySQL Configuration
# ═══════════════════════════════════════════════════════════════════════════════
proxysql.admin.port=6032
proxysql.admin.user=${PROXYSQL_ADMIN_USER:admin}
proxysql.admin.password=${PROXYSQL_ADMIN_PASSWORD}
proxysql.mysql.write-port=6033
proxysql.mysql.read-port=6034

# ═══════════════════════════════════════════════════════════════════════════════
# Orchestrator Configuration
# ═══════════════════════════════════════════════════════════════════════════════
orchestrator.url=http://localhost:3000
orchestrator.api-path=/api

# ═══════════════════════════════════════════════════════════════════════════════
# N8N Webhook (optional)
# ═══════════════════════════════════════════════════════════════════════════════
n8n.webhook-url=

# ═══════════════════════════════════════════════════════════════════════════════
# Actuator / Monitoring (Enhanced)
# ═══════════════════════════════════════════════════════════════════════════════
management.endpoints.web.exposure.include=health,info,metrics,prometheus,caches
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# ═══════════════════════════════════════════════════════════════════════════════
# Resilience4j Configuration
# ═══════════════════════════════════════════════════════════════════════════════
resilience4j.circuitbreaker.configs.default.register-health-indicator=true
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50

resilience4j.retry.configs.default.max-attempts=3
resilience4j.retry.configs.default.wait-duration=2s

# ═══════════════════════════════════════════════════════════════════════════════
# Logging (Enhanced with Correlation ID)
# ═══════════════════════════════════════════════════════════════════════════════
logging.level.root=INFO

# ═══════════════════════════════════════════════════════════════════════════════
# CORS Configuration (Restrict in production!)
# ═══════════════════════════════════════════════════════════════════════════════
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}

spring.output.ansi.enabled=ALWAYS
logging.pattern.console=%clr(%d{HH:mm:ss}){blue} %clr(%-5p) %clr([%X{correlationId:-N/A}]){yellow} %clr(%logger{25}){cyan} - %m%n
logging.level.com.dbaas=DEBUG
logging.level.com.github.dockerjava=WARN
logging.level.org.flywaydb=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=OFF
logging.level.io.github.resilience4j=INFO

# ═══════════════════════════════════════════════════════════════════════════════
# OpenAPI / Swagger
# ═══════════════════════════════════════════════════════════════════════════════
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
