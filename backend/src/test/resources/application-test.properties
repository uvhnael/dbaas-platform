# ═══════════════════════════════════════════════════════════════════════════════
# DBaaS Platform - Test Profile Configuration
# Uses H2 in-memory database for testing
# ═══════════════════════════════════════════════════════════════════════════════

spring.application.name=dbaas-platform-test

# ─────────────────────────────────────────────────────────────────────────────────
# H2 In-Memory Database for Testing
# ─────────────────────────────────────────────────────────────────────────────────
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect

# Disable Flyway for tests (using ddl-auto=create-drop)
spring.flyway.enabled=false

# ─────────────────────────────────────────────────────────────────────────────────
# Disable Redis for tests
# ─────────────────────────────────────────────────────────────────────────────────
spring.cache.type=simple
spring.data.redis.host=localhost
spring.data.redis.port=6379

# ─────────────────────────────────────────────────────────────────────────────────
# Security Configuration (Test values)
# ─────────────────────────────────────────────────────────────────────────────────
security.jwt.secret=dGVzdC1qd3Qtc2VjcmV0LWZvci11bml0LXRlc3RpbmctcHVycG9zZXMtb25seQ==
security.jwt.expiration-ms=86400000
security.jwt.refresh-expiration-ms=604800000
security.jwt.issuer=dbaas-platform-test

# Cluster Secrets (Test values)
security.cluster.mysql-root-password=test_root_password
security.cluster.replication-password=test_repl_password
security.cluster.orchestrator-password=test_orch_password
security.cluster.proxysql-admin-password=test_proxysql_password

# Encryption
security.encryption.key=dGVzdC1lbmNyeXB0aW9uLWtleS0zMi1ieXRlcw==
security.encryption.algorithm=AES/GCM/NoPadding

# Legacy JWT config
jwt.secret=${security.jwt.secret}
jwt.expiration=${security.jwt.expiration-ms}

# ─────────────────────────────────────────────────────────────────────────────────
# Docker Configuration (Disabled for tests)
# ─────────────────────────────────────────────────────────────────────────────────
docker.host=unix:///var/run/docker.sock
docker.tls-verify=false

# ─────────────────────────────────────────────────────────────────────────────────
# Cluster Defaults
# ─────────────────────────────────────────────────────────────────────────────────
cluster.defaults.mysql-version=8.0
cluster.defaults.replica-count=2
cluster.defaults.cpu-limit=2
cluster.defaults.memory-limit=4G
cluster.defaults.storage-limit=50G
cluster.network.subnet-prefix=172.28
cluster.ports.base=33060
cluster.ports.step=10

# ─────────────────────────────────────────────────────────────────────────────────
# ProxySQL Configuration
# ─────────────────────────────────────────────────────────────────────────────────
proxysql.admin.port=6032
proxysql.admin.user=admin
proxysql.admin.password=${security.cluster.proxysql-admin-password}
proxysql.mysql.write-port=6033
proxysql.mysql.read-port=6034

# ─────────────────────────────────────────────────────────────────────────────────
# Orchestrator Configuration
# ─────────────────────────────────────────────────────────────────────────────────
orchestrator.url=http://localhost:3000
orchestrator.api-path=/api

# ─────────────────────────────────────────────────────────────────────────────────
# Actuator (Disabled for tests)
# ─────────────────────────────────────────────────────────────────────────────────
management.endpoints.web.exposure.include=health

# ─────────────────────────────────────────────────────────────────────────────────
# Logging (Minimal for tests)
# ─────────────────────────────────────────────────────────────────────────────────
logging.level.root=WARN
logging.level.com.dbaas=INFO
logging.level.org.springframework.test=WARN
